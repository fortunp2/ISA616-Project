---
title: "Beach Tan Explanatory Analysis"
author: "Peter Fortunato"
date: "10/1/2020"
output: 
  html_document:
  toc: TRUE
  toc_float: TRUE
  number_sections: TRUE

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Introduction and Data Dictionary

Beach Tan Inc. is a major national franchiser of tanning salons. Their two main products include "UV Tans", which are offered in tanning beds or stand-up booths, and "Sunless Tans", which are provided via a spray-on solution and do not expose the user to any UV tans. 

In addition to their two methods of tanning, Beach Tan Inc. also sells specially formulated skin care products that can enhance the quality and duration of tanning results.

Beach Tan Inc. also offers a convenient membership program allows clients more control over their decision-making power.

Let's read in and explore the data:
```{r}
# Loading the library that reads in csv files
library(readr)

# Reading in the Beach Tan dataset
beach <- read.csv("BeachTan/BeachTan.csv")

# Viewing the head of the data
head(beach)
```

```{r}
# Viewing the structure of the data
str(beach)
```

This data frame of 11,041 observations and 12 variables was collected in 2014. According to the data dictionary, the variables in the model include:

* **UIDClient**: Client Indentification Number
* **UIDStoreLocation**: Store Identification Number (10 include in this data set)
* **Gender**: 0 = Female, 1 = Male
* **DateJoined**: Date the client joined (if non-member this is the date of their first tanning session)
* **DaysSinceJoined**: The number of days elapsed between DateJoined and 11/01/2014
* **MembershipType**: 0 = Non-Member, 1 = Monthly Membership, 2 = Annual Membership
* **MembershipLevel**: This variable corresponds to the strength and quality of tanning equipment offered to clients on what level of membership they have. Better equipment means faster tanning results. 0 = Non-Member, 1 = Fast, 2 = Faster, 3 = Fastest, 4 = Instant
* **Age**: The age of client in years
* **UVTans**: The number of UV Tans a client has received since joining Beach Tan
* **SunlessTans**: The number of Sunless Tans a client has received since joining Beach Tan
* **UpgradedRevenue**: The amount of extra money spent (in dollars) by members to tan in a higher level bed than what their regular membership would include.
* **RetailRevenue**: The amound of money spent (in dollars) by any client on various skin car lotions and products offered by Beach Tan

Looking at the structure of the Beach Tan data frame and understanding the information presented within the variables, it's clear that I will need to change the format of some of the variables. However, I will get to that in another section.

## 2. Analysis Preview and Revision of Business Value Proposition

In my original Business Value Proposition, I outlined how the two main products that I would deliver with my analysis were a predictive model to understand future clients' spend as well as a visualization dashboard to help non-members understand how their spending habbits would be better suited if they were to become a member.

After working with this data set for some time, I've come to the conclusion that neither of those two products are feasible. The predictive model cannot be done for there are no new observations in which to predict their total Retail Revenue. And for the visualization dashboard, the data doesn't really explain how much members are saving versus non-members.

It is for these reasons that I have decided to change the product which I will be offering. Instead of a predictive model and visualization dashboard, I shall conduct two explanatory analyses in order to understand two things: the variables that explain Retail Revenue as well as the variables that explain Upgraded Revenue. I believe these insights will still help Beach Tan understand how they can adjust their marketing and promotional strategies to increase company revenue.

## 3. Data Manipulation, Exploration and Preparation

As I explained previously, there are a number of variables that need to be reformatted in order for the models to accurately analyze the data. The variables UIDStoreLocation, Gender, MembershipType, and MembershipLevel are currently formatted as numeric and must be changed to factors. The variable DateJoined is currently formatted as a character and needs to be changed to a date variable.

```{r}
# changing the following numeric variables to factors
beach$UIDStoreLocation <- as.factor(beach$UIDStoreLocation)
beach$Gender <- as.factor(beach$Gender)
beach$MembershipType <- as.factor(beach$MembershipType)
beach$MembershipLevel <- as.factor(beach$MembershipLevel)

# changing the following character variable to a date
beach$DateJoined <- as.Date(beach$DateJoined, "%m/%d/%Y")
```

Next, I'm going to recode the new factors so that they say their actual level as opposed to just using a number that corresponds to their level. I will also recode the UIDStoreLocation variable so that it's labels are more agreeable to code. When I create dummy variables for these factors later on, this will help make them easier to understand in the model output. The tidyverse package contains a variaty of packages that will assist us in our analysis. I will preface any use of a function with the package that it comes from. For example, the function `recode_factor` belongs to the dplyr package in the tidyverse family.

```{r}
# Loading in the tidyverse package
library(tidyverse)

# Recoding the factors in Gender
beach$Gender <- recode_factor(beach$Gender, 
                              "0" = "Female",
                              "1" = "Male")

# Recoding the factors in MemebershipType
beach$MembershipType <- recode_factor(beach$MembershipType,
                                      "0" = "Non-Member",
                                      "1" = "Monthly",
                                      "2" = "Annual")

# Recoding the factors in MembershipLevel
beach$MembershipLevel <- recode_factor(beach$MembershipLevel,
                                       "0" = "Non-Member",
                                       "1" = "Fast",
                                       "2" = "Faster",
                                       "3" = "Fastest",
                                       "4" = "Instant")

# Recoding the factors in UIDStoreLocation
beach$UIDStoreLocation <- recode_factor(beach$UIDStoreLocation,
                                         "1" = "A",
                                         "2" = "B",
                                         "3" = "C",
                                         "4" = "D",
                                         "5" = "E",
                                         "6" = "F",
                                         "7" = "G",
                                         "8" = "H",
                                         "9" = "I",
                                         "10" = "J")
```

Now that the variables in the data are properly formatted, we can take an accurate overview of the data with help from the DataExplorer package. Let's first explore the distribution of missing values in the data set.

```{r}
# Loading the DataExplorer package
library(DataExplorer)

plot_missing(beach)
```

Gender and DaysSinceJoined are the only variables that have missing observations, but both of them have over 99.5% of their data, so it might not be a problem. 

Let's see how the distribution of continuous variables.

```{r}
# Distribution of the continuous variables
plot_histogram(beach)
```

There are a couple things I need to point out. First, UIDClient appears to be an unhelpful variable. This is likely due to the fact that each client has a unique ID number, making this information not useful when making a model. Let's remove UIDClient from the data.

```{r}
# The piping operator (%>%) and `select` functions belong to the dplyr package
beach <- beach %>%
  select(-UIDClient)
```

Second, the histogram for DaysSinceJoined appears to have values above 40,000, which indicates that some members/customers joined over 100 years ago. Let's see what's going on with these rows.

```{r}
# The `filter` function belongs to the dplyr package
filter(beach, DaysSinceJoined > 40000)
```

It's clear from this output that for each of these observations, DateJoined is missing. In fact, these are all of the 27 rows in which DateJoined is missing, and 27/11041 = 0.0024 or 0.24%. These rows could adversely affect the models, so it's a good idea to just remove them from the data.

```{r}
beach <- beach %>%
  filter(DaysSinceJoined < 40000)

hist(beach$DaysSinceJoined)
```
This distribution of DaysSinceJoined now looks more realistic.

While we are at it, we should also remove DateJoined from the data, as it will complicate the model and that type of information is already stored in the DaysSinceJoined variable.

```{r}
beach <- beach %>%
  select(-DateJoined)
```


Now let's look at the distribution of the categorical variables.

```{r}
# Distribution of factors
plot_bar(beach)
```

We can see here that Female and Non-Member customers make up the majority of the clientel of Beach Tan Inc. 

The Gender variable has a coule of N/A values, and there's no point in making an extra dummy variable for a level of a factor that has a miniscule number of obersvations, so let's remove them.

```{r}
# The `na_omit` function belongs to the stats package.
beach <- na.omit(beach)
plot_missing(beach)
```

Now we have a data set with exactly 0 missing rows.

# 4. Visualizing the Relationship between Retail Revenue and Predictor Variables



```{r}
ggplot(beach, aes(x = UIDStoreLocation, y = RetailRevenue)) +
  geom_col() +
  scale_x_discrete(limits = c("B", "J", "C", "H", "E", "I", "A", "F", "D", "G"))
```


# 5. Model Preparation

# 6. Creating the Models and Model Summary

# 7. Conclusion

